## 1. Общая информация

- **Название проекта:**

«**SportLink**»

- **Краткое описание:**

«**SportLink**» – это платформа для поиска партнеров и команд для занятий спортом. Приложение помогает спортсменам-любителям находить игроков для совместных тренировок или матчей в выбранном виде спорта, как индивидуальных (например, теннис), так и командных (например, футбол). Пользователи создают профили с указанием уровня игры и предпочтительных видов спорта, просматривают ленту потенциальных партнеров или открытые игры, а также отмечают на карте подходящие площадки. Сервис решает проблему поиска компаньонов для спорта поблизости, повышает активность сообщества и обеспечивает удобный способ организации любительских матчей.

## 2. Архитектура и стек

**Общая схема:**

Архитектура приложения - микросервисная, с API-шлюзом.

Основные компоненты:

1. API Gateway
    - Единственная точка входа для web/мобильных клиентов.
    - Маршрутизация запросов к внутренним сервисам.
    - Oauth2.0 Resourse Server, доверяющий Keycloak
2. Profile Service
    - Спортивный профиль (виды спорта, уровень, предпочтения, рейтинг)
    - Аватар, био, статистика, отзывы
3. Matche Service
    - События/Игры и их статусы
    - Списки пользователей, поиск и выбор
4. Rating Service
    - Отзывы и оценки после игр
    - Агрегированный рейтинг по уровню/поведению
5. Area Service
    - Спортивные площадки (бесплатные, платные)
    - Расположение, описание площадки, доступные виды спорта
    - Поиск ближайшей площадки
6. Messaging Service
    - Коммуникация между участниками одной игры или между двумя пользователями
7. Notification Service
    - Email/push уведомления о событиях
8. Admin Panel
    - Просмотр пользователей, матчей, жалоб (оценок с плохим рейтингом)
    - Блокировки, введения ограничений
9. Booking Service (потенциально)
    - Бронь площадок
10. Analytics Service (потенциально)
    - Сбора и анализ данных об играх, рейтингах, активности пользователей

**Взаимодействие:**

Клиент → API Gateway → микросервисы

Межсервисное взаимодействие по REST. В перспективе добавление асинхронных событий для уведомлений и рейтинга.

**Backend:**

- **Язык:** Kotlin
- **Фреймворк:** Spring Boot
- **Базы данных:**
    - PostgreSQL (отдельная бд/схема на сервис)
    - Для геоданных - расширение PostGIS.
- **Взаимодействие с клиентом:** REST API для основных операций (JSON как формат обмена данными). Авторизация с помощью OAuth2.

**Frontend / клиент:**

- **Тип клиента:** Web-приложение (SPA) на React для динамичного пользовательского интерфейса и мобильные клиенты (Android/IOS)
- **Взаимодействие с backend:** REST через API Gateway.

## 3. Пользовательские роли

**Пользователь (игрок):**

- Может регистрироваться в системе и создавать свой профиль (имя, фото, виды спорта, уровень навыка, био и пр.).
- Может просматривать ленту/список других игроков, имеющихся площадок или созданных игр, фильтровать по виду спорта, уровню, локации.
- Может создавать новое событие/игру (указать вид спорта, время, место, количество необходимых участников и пр.).
- Может отправлять запросы другим игрокам для совместной игры или присоединяться к созданным играм.
- Может просматривать карту с отмеченными спортивными площадками, добавлять бесплатные площадки или выбирать место из предложенных.
- Может переписываться с другими пользователями (через встроенный чат или обмен сообщениями) для согласования деталей встречи.
- После проведенной игры может оставить отзыв и выставить рейтинг другому участнику (оценить уровень навыка партнера и его спортивное поведение).
- Имеет доступ к своему рейтингу и отзывам, полученным от других, в своем профиле.

**Администратор:**

- Имеет доступ к административной панели.
- Может просматривать список всех пользователей, игр, площадок.
- Может модерировать контент и взаимодействия: блокировки пользователей и реакция на отзывы
- Может управлять справочником спортивных площадок (добавлять/редактировать/удалять локации, если пользователи предлагают новые места).
- Имеет возможность просматривать и анализировать рейтинги и отзывы, выявлять недобросовестных пользователей.

*(В дальнейшем могут появиться дополнительные роли, например, **Тренер** – пользователь, предлагающий платные тренерские услуги)*

## 4. Основные сценарии использования (User Stories)

- **US-1:** Как новый пользователь, я хочу зарегистрироваться и создать свой профиль с информацией о предпочтениях и уровне в видах спорта, чтобы другие игроки могли меня найти и пригласить на игру.
- **US-2:** Как пользователь, я хочу просматривать ленту потенциальных партнёров по спорту, чтобы выбрать подходящего человека для совместной тренировки или матча.
- **US-3:** Как пользователь, я хочу создать событие для игры с указанием времени, места на карте и требуемого количества игроков, чтобы собрать команду или найти соперника.
- **US-4:** Как пользователь, я хочу присоединиться к уже созданной игре или откликнуться на приглашение другого игрока, чтобы принять участие в матче на удобной для меня площадке и времени.
- **US-5:** Как пользователь, я хочу видеть на карте доступные спортивные площадки (бесплатные и платные) для выбранного вида спорта, чтобы выбрать удобное место встречи или понять, где можно поиграть.
- **US-6:** Как участник сыгранного матча, я хочу оставить отзыв и оценить своего партнёра/соперника (по уровню игры и поведению), чтобы отметить надёжность и уровень игроков для других пользователей.
- **US-7:** Как администратор, я хочу получать жалобы от пользователей и просматривать спорные ситуации, чтобы оперативно реагировать и повышать безопасность сообщества.

## 5. Функциональные требования

### 5.1 Backend

**5.1.1 API Gateway**

- **FR-GW-1:** *Регистрация пользователей:* Система должна позволять пользователю зарегистрироваться, создав учетную запись с уникальными идентификатором (логин или email) и паролем.
- **FR-GW-2:** API Gateway должен принимать только запросы с валидным access token’ом Keycloak.
- **FR-GW-3:** API Gateway должен проводить валидацию JWT.
- **FR-GW-4:** API Gateway должен маршрутизировать запросы к нужным микросервисам.
- **FR-GW-5:** Для админских эндпоинтов Gateway должен проверять наличие роли ADMIN в токене и отклонять запросы без неё.

**5.1.1 Profiles Service**

- **FR-PR-1:** Хранить данные о спортивных профилях пользователей
- **FR-PR-2:** Предоставлять API для создания/обновления профиля текущего пользователя
- **FR-PR-4:** Предоставлять API для поиска профилей по виду спорта, локации и диапазону уровней (фильтры).

**5.1.2 Matches Service**

- **FR-MA-1:** Позволять авторизованному пользователю создавать матч (игру)
- **FR-MA-2:** Хранить статус матча: OPEN, READY, FINISHED, CANCELLED.
- **FR-MA-3:** Предоставлять API для присоединения текущего пользователя к матчу
- **FR-MA-4:** Предоставлять API для получения списка матчей с фильтрами по виду спорта, дате/времени и радиусу от точки (интеграция с Area Service по координатам площадки).
- **FR-MA-5:** Предоставлять API для изменения статуса матча организатором.
- **FR-MA-6:** При завершении матча генерировать событие/вызывать Ratings Service, передавая *matchId* и список участников (для возможности выставления оценок).

**5.1.3 Ratings Service**

- **FR-RA-1:** Принимать запросы на выставление оценки участникам матча.
- **FR-RA-2:** Хранить отдельные отзывы и уметь считать агрегированные показатели по пользователю.
- **FR-RA-3:** Предоставлять API для получения агрегированного рейтинга и списка отзывов по userId для отображения в профиле (с пагинацией).

**5.1.4 Area Service**

- **FR-PL-1:** Хранить площадки cо всей информацией (описание, местоположение, виды спорта и тд.)
- **FR-PL-2:** Предоставлять API для получения площадок.
- **FR-PL-3:** Предоставлять API для предложения новой площадки пользователем.

**5.1.5 Messaging Service**

- **FR-ME-1:** Отправлять и принимать сообщения от авторизованного пользователя
- **FR-ME-2:** Предоставлять API для получения истории сообщений по чату (с пагинацией) и получения новых сообщений в реальном времени.

**5.1.6 Notifications Service**

- **FR-NO-1:** Принимать из других сервисов события (новый участник в матче, матч скоро начнётся, новое собщение)
- **FR-NO-2:** На их основе формировать уведомления.

**5.1.7 Admin Panel (админская функциональность в разных микросервисах)**

- **FR-AD-1:** Просматривать список пользователей.
- **FR-AD-2:** Блокировать пользователей.
- **FR-AD-3:** редактировать/удалять площадки и отзывы.

### 5.2 Frontend / клиент (веб-приложение)

- **FR-FE-1:** Экран «Войти/Зарегистрироваться» (кнопки «Войти», «Зарегистрироваться»)
- **FR-FE-2:** Страница профиля:
    - просмотр своих данных (имя, виды спорта, уровень, рейтинг),
    - форма редактирования профиля (POST/PUT в Profiles Service),
    - загрузка аватара (отправка файла/URL на бек с получением ссылки).
- **FR-FE-3:** Лента игроков:
    - отображение списка карточек пользователей с их видами спорта, уровнем и рейтингом,
    - фильтры по виду спорта, уровню, локации,
    - при клике — переход в подробный профиль.
- **FR-FE-4:** Лента матчей:
    - список матчей (карточки с видом спорта, временем, местом, статусом),
    - фильтры и сортировка (по времени, расстоянию, виду спорта),
    - кнопка «Присоединиться» с вызовом Matches Service.
- **FR-FE-5:** Карта площадок:
    - встроенная карта,
    - отображение площадок от Area Service,
    - возможность выбрать площадку при создании матча.
- **FR-FE-6:** Создание/редактирование матча:
    - форма с выбором вида спорта, даты/времени, места, лимита участников,
    - отправка POST/PUT запроса на Matches Service
- **FR-FE-7:** Экран матча:
    - отображение участников, статуса, чата,
    - кнопка «Присоединиться» / «Покинуть» (если будет),
    - для организатора — кнопка «Отменить» / «Отметить как завершённый».
- **R-FE-8:** Чат:
    - список сообщений по матчу/диалогу,
    - поле ввода и отправка сообщений через Messaging Service
- **FR-FE-9:** Оценка после матча:
- после завершения матча — UI для оценивания каждого участника:
    - выбор «уровень соперника»
    - звёздочки/слайдер поведения
- отправка оценок в Ratings Service.
- **FR-FE-10:** Уведомления:
    - отображение индикатора новых уведомлений (badge),
    - список уведомлений (новый участник, напоминание о матче, новый отзыв)
- **FR-FE-11:** Админ-панель (для роли ADMIN):
    - доступ только при наличии соответствующей роли в токене,
    - таблицы пользователей, матчей, площадок, отзывов,
    - действия: забанить пользователя, удалить отзыв, одобрить площадку и т.п.

## 6. Нефункциональные требования

**Производительность:**

- Основные API (поиск матчей, профилей, площадок) должны отвечать за < 500 мс при нескольких тысяч активных пользователей
- Начальная загрузка приложения – не более нескольких секунд на среднем устройстве.

**Надёжность и отказоустойчивость:**

- Отказ отдельных сервисов (например, Notifications, Messaging) не должен ломать базовый функционал (создание матчей, поиск партнёров).

**Безопасность:**

- Аутентификация пользователей полностью делегирована Keycloak (OAuth2/OIDC).
- Доступ к админским эндпоинтам разрешён только при наличии роли ADMIN в токене.
- Личные данные пользователей (email, контакты) не показываются другим без разрешения.
- Для повышения доверия пользователей возможна верификация аккаунтов (например, подтверждение телефона, интеграция с социальными сетями для проверки реальности профиля) – эти меры могут быть внедрены по необходимости.

**Логирование и мониторинг:**

- Backend-сервис должен вести логирование ключевых событий: регистрации новых пользователей, входов, создания/отмены игр, ошибок (с полным стек-трейсом для отладки).
- Логи должны сохраняться в файл или систему логирования и хранением в течение определенного периода.
- Health-check для каждого сервиса. Интеграция с инструментами мониторинга (Prometheus/Grafana или аналог) для отслеживания метрик и оповещения о сбоях.
- В случае критических ошибок система должна уведомлять администратора (например, отправка email при падении сервиса или при частых ошибках 5xx).

**Удобство использования (UX):**

- Понятная структура интерфейсов: «Мои матчи», «Найти матч», «Карта площадок», «Партнёры», «Профиль».
- Чёткие сообщения об ошибках (без тех. деталей).
- Адаптивная верстка

## 7. Ограничения и допущения

- **Ограничение по видам спорта:** для упрощения MVP предполагается запуск с ограниченным набором видов спорта (например, теннис, футбол и, возможно, баскетбол). Новые виды спорта и связанные с ними особенности будут добавляться по мере развития проекта.
- **Географический фокус:** изначально система ориентирована на определенный регион/город (Москва) для MVP. Расширение на новые города и страны – в перспективе.
- **Интеграции:** в рамках MVP не реализованы интеграции с платежными системами и внешними сервисами бронирования. Все бронирования платных площадок, если необходимы, происходят вне приложения (пользователь помечает только место встречи). В будущем возможна интеграция API с системами аренды кортов.
- **Тренерские услуги:** функциональность поиска тренеров и организации платных тренировок пока не реализуется. Данный функционал может быть добавлен как отдельный модуль позднее.
- **Монетизация:** в рамках учебного проекта вопрос монетизации (платные подписки, комиссии за бронирование, реклама) не прорабатывается.
- Отсутствие синхронизации внешних календарей, рекомендации матчей на основе маши́нного обучения. Эти возможности могут быть добавлены в будущем.

## 8. Критерии готовности / проверки

Перечень критериев и пример сценария для проверки:

- Реализованы все функции, отмеченные в разделе функциональных требований (раздел 5), как на стороне сервера, так и на стороне клиента.
- Пользовательские истории (раздел 4) могут быть проиграны в приложении полностью: от регистрации до получения рейтинга.
- Интерфейс понятен и корректно отображается, ошибки обрабатываются
- Отсутствие критических сбоев

**Тестовый сценарий (сквозной):**

1. *Регистрация нового пользователя:* Открыть приложение, перейти на экран регистрации. Ввести уникальный email, пароль, имя. Успешно создать аккаунт и автоматически войти в систему.
2. *Заполнение профиля:* Зайти в раздел профиля, загрузить фото, выбрать вид спорта «Теннис», указать свой уровень (например, средний). Сохранить профиль и убедиться, что данные отобразились.
3. *Создание игры:* Перейти в раздел «Мои игры» или на главную страницу. Нажать «Создать игру», заполнить форму: спорт = теннис, дата = завтра 18:00, место = выбрать бесплатную площадку на карте рядом (например, теннисный корт в парке), требуется 2 игрока (один соперник). Подтвердить создание. Убедиться, что игра появилась в списке событий с статусом «Ожидает игрока».
4. *Поиск другим пользователем:* (Эмулируется второй пользователь) Зарегистрировать второго пользователя или использовать тестовый аккаунт B. Заполнить его профиль (также теннис, уровень близкий). В поиске событий увидеть созданное пользователем A событие на завтра – открыть его и нажать «Присоединиться». Убедиться, что статус события обновился, и теперь в участниках значатся пользователь A (создатель) и пользователь B. Пользователь A получает уведомление о присоединении B.
5. *Обмен сообщениями:* Пользователь A открывает событие и пишет сообщение в чате «Привет, давай встретимся за 15 минут до игры». Пользователь B видит сообщение и отвечает. Оба могут координировать детали встречи.
6. *Реализация игры и рейтинг:* Предполагается, что на следующий день матч состоялся. После указанного времени события система либо автоматически, либо по отметке пользователя помечает событие как «Завершено». Приложение предлагает оставить отзыв. Пользователь A заходит в профиль B (или в раздел «Оценить игрока») и выбирает оценку: уровень соперника **соответствовал** заявленному, поведение **5/5** (отлично). Пользователь B аналогично оценивает A. Оба отзыва сохраняются.
7. *Проверка рейтинга:* Пользователь A открывает профиль B и видит там обновившийся рейтинг (например, средняя оценка поведения 5.0, и отметка «уровень соответствует заявленному» со стороны A). Пользователь B видит аналогичную информацию о A.
8. *Модерация (опционально):* Проверить, что администраторский функционал доступен под учетной записью администратора. Администратор заходит, видит список всех пользователей (A и B), при необходимости может изменить им статус (например, пометить как проверенных или заблокировать – для теста отметить B заблокированным и убедиться, что B больше не может войти).